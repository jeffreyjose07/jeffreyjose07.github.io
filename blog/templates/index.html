<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - Jeffrey Jose</title>
    <meta name="description" content="{{description}}" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/blog/feed.xml" />

    {{styles}}

    <style>
        body {
            padding-top: 100px;
        }

        .blog-header {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
        }

        .blog-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .blog-description {
            color: var(--muted-foreground);
            font-size: 1.125rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .post-item {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 0;
            /* Removed padding to allow image to bleed */
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .post-thumbnail {
            height: 180px;
            width: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .thumbnail-icon {
            font-size: 3rem;
            opacity: 0.5;
        }

        .post-content-wrapper {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .post-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(800px circle at var(--mouse-x) var(--mouse-y), rgba(255, 255, 255, 0.06), transparent 40%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            z-index: 1;
        }

        .post-item:hover::before {
            opacity: 1;
        }

        .post-item a {
            display: flex;
            flex-direction: column;
            height: 100%;
            text-decoration: none;
            z-index: 2;
        }

        .post-meta-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }

        .episode-number {
            font-family: var(--font-mono);
            color: var(--primary);
            background: rgba(124, 58, 237, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .post-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--foreground);
            transition: color 0.2s;
        }

        .post-item:hover .post-title {
            color: var(--primary-glow);
        }

        .post-description {
            color: var(--muted-foreground);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: auto;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .tag-pill {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--muted-foreground);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .post-item:hover .tag-pill {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary-glow);
            border-color: rgba(124, 58, 237, 0.2);
        }

        /* Tag Filters */
        .tag-filters-container {
            margin-bottom: 3rem;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            max-height: 90px;
            /* Show roughly 2 rows */
            overflow: hidden;
            transition: max-height 0.3s ease;
            position: relative;
        }

        .tag-filters-container.expanded {
            max-height: 1000px;
        }

        .tag-toggle-btn {
            background: transparent;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: block;
            margin: 0 auto 3rem auto;
            font-family: var(--font-sans);
        }

        .tag-toggle-btn:hover {
            text-decoration: underline;
        }

        .tag-filter {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--muted-foreground);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            cursor: pointer;
            font-family: var(--font-sans);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .tag-filter:hover,
        .tag-filter.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 4rem;
            flex-wrap: wrap;
        }

        .pagination-link {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            padding: 0 0.5rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--muted-foreground);
            text-decoration: none;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }

        .pagination-link:hover,
        .pagination-link.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
        }

        .pagination-link.active {
            font-weight: bold;
        }

        .pagination-nav {
            width: auto;
            padding: 0 1.25rem;
            border-radius: 9999px;
            font-family: var(--font-sans);
            font-weight: 500;
        }

        /* Featured Post Layout (Desktop) */
        @media (min-width: 1024px) {
            .posts-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .post-item:first-child {
                grid-column: 1 / -1;
                min-height: 450px;
            }

            .post-item:first-child a {
                flex-direction: row;
            }

            .post-item:first-child .post-thumbnail {
                width: 60%;
                height: auto;
                min-height: 100%;
                border-bottom: none;
                border-right: 1px solid rgba(255, 255, 255, 0.05);
            }

            .post-item:first-child .post-content-wrapper {
                width: 40%;
                justify-content: center;
                padding: 4rem;
            }

            .post-item:first-child .post-title {
                font-size: 3rem;
                margin-bottom: 1.5rem;
                background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .post-item:first-child .post-description {
                font-size: 1.25rem;
                -webkit-line-clamp: 5;
            }
        }

        /* Stats Footer */
        .stats-footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            color: var(--muted-foreground);
            font-size: 0.875rem;
        }

        .stats-footer a {
            color: var(--foreground);
            text-decoration: underline;
            text-decoration-color: var(--muted-foreground);
            text-underline-offset: 4px;
        }

        .stats-footer a:hover {
            color: var(--primary);
            text-decoration-color: var(--primary);
        }
    </style>
</head>

<body class="bg-mesh">
    {{siteHeader}}

    <main class="container animate-fade-in-up">
        <header class="blog-header">
            <h1 class="blog-title">{{title}}</h1>
            <p class="blog-description">{{description}}</p>
        </header>

        <div class="tag-filters-container" id="tagFilters">
            <button class="tag-filter active" data-tag="all">All Posts</button>
            {{tagFilters}}
        </div>
        <button id="tagToggleBtn" class="tag-toggle-btn">Show more tags</button>

        <div class="posts-grid" id="postsGrid">
            {{posts}}
        </div>

        {{pagination}}

        <footer class="stats-footer">
            <p>
                Total posts: {{totalPosts}} ¬∑
                <a href="/blog/archive.html">Archive</a> ¬∑
                <a href="/blog/feed.xml">RSS Feed</a>
            </p>
        </footer>
    </main>

    <script>
        const POSTS_PER_PAGE = 10;
        const allPostsData = {{ allPostsData }}; // Embedded from Node.js script

        // Mouse move effect for cards
        document.getElementById('postsGrid').onmousemove = e => {
            for (const card of document.getElementsByClassName("post-item")) {
                const rect = card.getBoundingClientRect(),
                    x = e.clientX - rect.left,
                    y = e.clientY - rect.top;

                card.style.setProperty("--mouse-x", `${x}px`);
                card.style.setProperty("--mouse-y", `${y}px`);
            }
        };

        // Utility function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = [
                'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
            ];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }

        // Function to render posts and pagination
        function renderPostsAndPagination(postsToDisplay, currentPage = 1) {
            const postsGrid = document.getElementById('postsGrid');
            const paginationContainer = document.querySelector('.pagination');

            postsGrid.innerHTML = ''; // Clear current posts
            paginationContainer.innerHTML = ''; // Clear current pagination

            const totalPages = Math.ceil(postsToDisplay.length / POSTS_PER_PAGE);
            const startIndex = (currentPage - 1) * POSTS_PER_PAGE;
            const endIndex = startIndex + POSTS_PER_PAGE;
            const paginatedPosts = postsToDisplay.slice(startIndex, endIndex);

            // Render posts
            paginatedPosts.forEach(post => {
                const div = document.createElement('div');
                div.classList.add('post-item', 'glass-card');
                div.dataset.tags = post.tags.join(' ');

                const episodeNum = post.episodeNumber.toString().padStart(3, '0');
                const tagsHtml = post.tags.map(tag => `<span class="tag-pill">${tag}</span>`).join('');

                let thumbnailHtml = '';
                if (post.thumbnail) {
                    const thumbSrc = post.thumbnail.startsWith('http') ? post.thumbnail : `/blog/${post.thumbnail}`;
                    thumbnailHtml = `<div class="post-thumbnail" style="background-image: url('${thumbSrc}')"></div>`;
                } else {
                    const hue = (post.episodeNumber * 137.508) % 360;
                    thumbnailHtml = `<div class="post-thumbnail" style="background: linear-gradient(135deg, hsl(${hue}, 60%, 20%), hsl(${hue + 40}, 60%, 10%))">
                        <div class="thumbnail-icon">üìù</div>
                    </div>`;
                }

                div.innerHTML = `
                    <a href="/blog/${post.slug}">
                        ${thumbnailHtml}
                        <div class="post-content-wrapper">
                            <div class="post-meta-top">
                                <span class="episode-number">#${episodeNum}</span>
                                <span class="date">${formatDate(post.date)}</span>
                            </div>
                            <h3 class="post-title">${post.title}</h3>
                            <p class="post-description">${post.description}</p>
                            <div class="post-tags">
                                ${tagsHtml}
                            </div>
                        </div>
                    </a>
                `;
                postsGrid.appendChild(div);
            });

            // Render pagination controls
            if (totalPages > 1) {
                if (currentPage > 1) {
                    const prevLink = document.createElement('a');
                    prevLink.href = '#';
                    prevLink.classList.add('pagination-link', 'pagination-nav');
                    prevLink.innerHTML = 'Previous';
                    prevLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPostsAndPagination(postsToDisplay, currentPage - 1);
                        window.scrollTo(0, 0); // Scroll to top
                    });
                    paginationContainer.appendChild(prevLink);
                }

                for (let i = 1; i <= totalPages; i++) {
                    const pageLink = document.createElement('a');
                    pageLink.href = '#';
                    pageLink.classList.add('pagination-link');
                    if (i === currentPage) {
                        pageLink.classList.add('active');
                    }
                    pageLink.textContent = i;
                    pageLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPostsAndPagination(postsToDisplay, i);
                        window.scrollTo(0, 0); // Scroll to top
                    });
                    paginationContainer.appendChild(pageLink);
                }

                if (currentPage < totalPages) {
                    const nextLink = document.createElement('a');
                    nextLink.href = '#';
                    nextLink.classList.add('pagination-link', 'pagination-nav');
                    nextLink.innerHTML = 'Next';
                    nextLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPostsAndPagination(postsToDisplay, currentPage + 1);
                        window.scrollTo(0, 0); // Scroll to top
                    });
                    paginationContainer.appendChild(nextLink);
                }
            }
        }

        // Tag filtering functionality
        document.addEventListener('DOMContentLoaded', function () {
            const filterButtons = document.querySelectorAll('.tag-filter');

            // Check for tag in URL hash on page load
            function checkUrlHash() {
                const hash = window.location.hash;
                if (hash.startsWith('#tag-')) {
                    const tag = hash.substring(5); // Remove '#tag-' prefix
                    const tagButton = document.querySelector(`[data-tag="${tag}"]`);
                    if (tagButton) {
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        tagButton.classList.add('active');
                        filterPosts(tag);
                    }
                }
            }

            function filterPosts(tag) {
                let filteredPosts = [];
                if (tag === 'all') {
                    filteredPosts = allPostsData;
                } else {
                    filteredPosts = allPostsData.filter(post => post.tags.includes(tag));
                }
                renderPostsAndPagination(filteredPosts);
            }

            filterButtons.forEach(button => {
                button.addEventListener('click', function () {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const tag = this.dataset.tag;
                    filterPosts(tag);

                    if (tag !== 'all') {
                        history.replaceState(null, null, `/blog#tag-${tag}`);
                    } else {
                        history.replaceState(null, null, '/blog');
                    }
                });
            });

            checkUrlHash();

            // Tag toggle functionality
            const tagContainer = document.getElementById('tagFilters');
            const tagToggleBtn = document.getElementById('tagToggleBtn');

            // Check if we need to show the button
            if (tagContainer.scrollHeight > 100) {
                tagToggleBtn.style.display = 'block';
            } else {
                tagToggleBtn.style.display = 'none';
            }

            tagToggleBtn.addEventListener('click', () => {
                tagContainer.classList.toggle('expanded');
                if (tagContainer.classList.contains('expanded')) {
                    tagToggleBtn.textContent = 'Show less tags';
                } else {
                    tagToggleBtn.textContent = 'Show more tags';
                }
            });
        });
    </script>

    <!-- GoatCounter Analytics -->
    <script data-goatcounter="https://jeffreyjose.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>

</html>