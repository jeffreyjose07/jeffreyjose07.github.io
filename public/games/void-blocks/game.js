(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();let x=class{constructor(e,t,i){this.width=e,this.height=t,this.cellSize=i,this.cells=Array(t).fill().map(()=>Array(e).fill(0)),this.virusCells=Array(t).fill().map(()=>Array(e).fill(!1)),this.virusSpreadTimer=0,this.virusSpreadDelay=180,this.colors={0:new Color(0,0,0,0),1:new Color(.2,1,.2,1),2:new Color(.2,1,1,1),3:new Color(1,.2,1,1),4:new Color(1,.2,.2,1),5:new Color(1,1,.2,1)},this.gridOffset=vec2(100,50)}update(){this.updateVirusSpread()}updateVirusSpread(){this.virusSpreadTimer++,this.virusSpreadTimer>=this.virusSpreadDelay&&(this.spreadVirus(),this.virusSpreadTimer=0)}spreadVirus(){const e=this.virusCells.map(t=>[...t]);for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.virusCells[t][i]&&[[0,1],[0,-1],[1,0],[-1,0]].forEach(([r,o])=>{const l=i+r,n=t+o;this.isValidPosition(l,n)&&this.cells[n][l]>0&&!this.virusCells[n][l]&&Math.random()<.3&&(e[n][l]=!0,this.cells[n][l]=4)});this.virusCells=e}render(){for(let s=0;s<this.height;s++)for(let r=0;r<this.width;r++){const o=vec2(this.gridOffset.x+r*this.cellSize,this.gridOffset.y+s*this.cellSize),l=new Color(.1,.4,.1,.3);if(drawRect(o.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize-1,this.cellSize-1),l),this.cells[s][r]>0){let n=this.colors[this.cells[s][r]];if(this.virusCells[s][r]){n=new Color(1,.2,.2,.9);const u=vec2(Math.sin(time*10)*2,Math.cos(time*8)*1);drawRect(o.add(vec2(this.cellSize/2,this.cellSize/2)).add(u),vec2(this.cellSize-2,this.cellSize-2),n)}else drawRect(o.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize-2,this.cellSize-2),n);const f=new Color(n.r,n.g,n.b,.3);drawRect(o.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize+2,this.cellSize+2),f)}}const e=new Color(.2,1,1,1),t=vec2(this.gridOffset.x+this.width*this.cellSize/2,this.gridOffset.y+this.height*this.cellSize/2),i=vec2(this.width*this.cellSize+4,this.height*this.cellSize+4);drawRectOutline(t,i,e,2)}canPlacePiece(e,t,i){const s=e.shape;for(let r=0;r<s.length;r++)for(let o=0;o<s[r].length;o++)if(s[r][o]){const l=t+o,n=i+r;if(!this.isValidPosition(l,n)||this.cells[n][l]!==0)return!1}return!0}placePiece(e){const t=e.shape;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++)if(t[i][s]){const r=e.x+s,o=e.y+i;this.isValidPosition(r,o)&&(this.cells[o][r]=e.type,Math.random()<.1&&(this.virusCells[o][r]=!0,this.cells[o][r]=4))}}clearFullLines(){let e=0;for(let t=this.height-1;t>=0;t--)this.isLineFull(t)&&(this.clearLine(t),e++,t++);return e}isLineFull(e){return this.cells[e].every(t=>t!==0)}clearLine(e){this.cells.splice(e,1),this.virusCells.splice(e,1),this.cells.unshift(Array(this.width).fill(0)),this.virusCells.unshift(Array(this.width).fill(!1))}isValidPosition(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}isGameOver(){return this.cells[0].some(e=>e!==0)}};window.Grid=x;const m=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]]];let P=class v{constructor(e,t,i=null){this.x=e,this.y=t,this.shapeIndex=i!==null?i:Math.floor(Math.random()*m.length),this.shape=JSON.parse(JSON.stringify(m[this.shapeIndex])),this.type=this.getRandomType(),this.rotation=0,this.gridOffset=vec2(100,50),this.cellSize=24,this.colors={1:new Color(.2,1,.2,1),2:new Color(.2,1,1,1),3:new Color(1,.2,1,1),4:new Color(1,.2,.2,1),5:new Color(1,1,.2,1)}}getRandomType(){const e=[60,20,10,5,5],t=Math.random()*100;let i=0;for(let s=0;s<e.length;s++)if(i+=e[s],t<=i)return s+1;return 1}render(){for(let e=0;e<this.shape.length;e++)for(let t=0;t<this.shape[e].length;t++)if(this.shape[e][t]){const i=vec2(this.gridOffset.x+(this.x+t)*this.cellSize,this.gridOffset.y+(this.y+e)*this.cellSize);let s=this.colors[this.type];if(this.type===2){const l=.8+.2*Math.sin(time*4);s=new Color(.2*l,1*l,1*l,1)}else if(this.type===4){const l=vec2(Math.sin(time*15)*1,Math.cos(time*12)*1);i.x+=l.x,i.y+=l.y}else if(this.type===5){const l=.7+.3*Math.sin(time*8);s=new Color(1*l,1*l,.2*l,1)}drawRect(i.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize-2,this.cellSize-2),s);const r=new Color(s.r,s.g,s.b,.3);drawRect(i.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize+1,this.cellSize+1),r);const o=new Color(Math.min(1,s.r+.3),Math.min(1,s.g+.3),Math.min(1,s.b+.3),.5);drawRect(i.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize/2,this.cellSize/2),o)}}rotate(){this.shape=this.rotateMatrix(this.shape),this.rotation=(this.rotation+1)%4}getRotated(){const e=new v(this.x,this.y,this.shapeIndex);return e.shape=this.rotateMatrix(this.shape),e.type=this.type,e.rotation=(this.rotation+1)%4,e}rotateMatrix(e){const t=e.length,i=e[0].length,s=Array(i).fill().map(()=>Array(t).fill(0));for(let r=0;r<t;r++)for(let o=0;o<i;o++)s[o][t-1-r]=e[r][o];return s}getGhostPosition(e){let t=this.y;for(;e.canPlacePiece(this,this.x,t+1);)t++;return t}renderGhost(e){const t=this.getGhostPosition(e);if(t!==this.y){for(let i=0;i<this.shape.length;i++)for(let s=0;s<this.shape[i].length;s++)if(this.shape[i][s]){const r=vec2(this.gridOffset.x+(this.x+s)*this.cellSize,this.gridOffset.y+(t+i)*this.cellSize),o=new Color(.5,.5,.5,.3);drawRectOutline(r.add(vec2(this.cellSize/2,this.cellSize/2)),vec2(this.cellSize-2,this.cellSize-2),o,1)}}}};window.Piece=P;let z=class{constructor(){this.score=0,this.lines=0,this.level=1,this.dropTimer=0,this.dropDelay=60,this.baseDropDelay=60,this.firewallMode=!1,this.firewallTimer=0,this.firewallDuration=600,this.systemCorruption=0,this.maxCorruption=100,this.scoreMultipliers={1:40,2:100,3:300,4:1200},this.glitchIntensity=0}update(){this.updateDrop(),this.updateFirewall(),this.updateSystemCorruption(),this.updateLevel()}updateDrop(){this.dropTimer++}shouldDropPiece(){return this.dropTimer>=this.dropDelay?(this.dropTimer=0,!0):!1}updateFirewall(){this.level%10===0&&this.level>0&&!this.firewallMode&&this.activateFirewall(),this.firewallMode&&(this.firewallTimer++,this.firewallTimer>=this.firewallDuration&&this.deactivateFirewall())}activateFirewall(){this.firewallMode=!0,this.firewallTimer=0,this.dropDelay=Math.max(10,this.dropDelay/3),console.log("FIREWALL CHALLENGE ACTIVATED!")}deactivateFirewall(){this.firewallMode=!1,this.firewallTimer=0,this.dropDelay=this.baseDropDelay,console.log("Firewall challenge completed")}updateSystemCorruption(){this.systemCorruption>0&&(this.systemCorruption=Math.max(0,this.systemCorruption-.1)),this.glitchIntensity=this.systemCorruption/this.maxCorruption}updateLevel(){const e=Math.floor(this.lines/10)+1;e!==this.level&&(this.level=e,this.updateDropSpeed())}updateDropSpeed(){this.baseDropDelay=Math.max(3,Math.floor(60*Math.pow(.8,this.level-1))),this.firewallMode||(this.dropDelay=this.baseDropDelay)}addScore(e){if(e>0&&e<=4){let t=this.scoreMultipliers[e]*this.level;this.firewallMode&&(t*=2),this.score+=t,this.lines+=e,this.systemCorruption=Math.max(0,this.systemCorruption-e*5)}}addVirusCorruption(e){this.systemCorruption=Math.min(this.maxCorruption,this.systemCorruption+e),this.systemCorruption>=this.maxCorruption&&this.triggerSystemFailure()}triggerSystemFailure(){console.log("SYSTEM FAILURE - CORRUPTION AT MAXIMUM!")}activateDataFragment(){this.dropDelay*=2,setTimeout(()=>{this.dropDelay=this.firewallMode?this.baseDropDelay/3:this.baseDropDelay},3e3),console.log("Data fragment activated - Time slowed!")}clearVirusBlocks(e){for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)e.virusCells[t][i]&&(e.cells[t][i]=0,e.virusCells[t][i]=!1);this.systemCorruption=Math.max(0,this.systemCorruption-20),console.log("All virus blocks cleared!")}gameOver(){console.log("Game Over!"),console.log(`Final Score: ${this.score}`),console.log(`Lines Cleared: ${this.lines}`),console.log(`Level Reached: ${this.level}`);const e=localStorage.getItem("voidBlocksHighScore")||0;this.score>e&&(localStorage.setItem("voidBlocksHighScore",this.score.toString()),console.log("New high score!"))}getScore(){return this.score}getLevel(){return this.level}getLines(){return this.lines}getSystemCorruption(){return this.systemCorruption}isFirewallActive(){return this.firewallMode}getGlitchIntensity(){return this.glitchIntensity}getHighScore(){return parseInt(localStorage.getItem("voidBlocksHighScore")||"0")}};window.GameLogic=z;let O=class{constructor(){this.font="Monaco, Menlo, monospace",this.fontSize=16,this.glitchOffset=vec2(0,0),this.colors={terminal:new Color(.2,1,.2,1),data:new Color(.2,1,1,1),virus:new Color(1,.2,.2,1),warning:new Color(1,1,.2,1),background:new Color(0,0,.07,.8)},this.panels={score:{pos:vec2(500,100),size:vec2(180,120)},next:{pos:vec2(500,250),size:vec2(180,100)},status:{pos:vec2(500,380),size:vec2(180,150)}}}render(e,t,i){this.renderScorePanel(e,t,i),this.renderStatusPanel(t),this.renderInstructions(),this.renderTitle()}renderPanel(e,t){drawRect(e.pos,e.size,this.colors.background);const i=this.colors.data;if(drawRectOutline(e.pos,e.size,i,1),drawRectOutline(e.pos,e.size.scale(1.02),new Color(i.r,i.g,i.b,.3),1),t){const s=vec2(e.pos.x,e.pos.y-e.size.y/2+20);this.drawGlowText(t,s,this.colors.data,this.fontSize)}}renderScorePanel(e,t,i){const s=this.panels.score;this.renderPanel(s,"SYSTEM STATUS");const r=s.pos.y-s.size.y/2+40,o=20;this.drawGlowText("SCORE",vec2(s.pos.x,r),this.colors.terminal,12),this.drawGlowText(this.formatNumber(e),vec2(s.pos.x,r+o),this.colors.terminal,14),this.drawGlowText("LEVEL",vec2(s.pos.x,r+o*2.5),this.colors.data,12),this.drawGlowText(t.toString(),vec2(s.pos.x,r+o*3.5),this.colors.data,14),this.drawGlowText("LINES",vec2(s.pos.x,r+o*5),this.colors.terminal,12),this.drawGlowText(i.toString(),vec2(s.pos.x,r+o*6),this.colors.terminal,14)}renderStatusPanel(e){const t=this.panels.status;this.renderPanel(t,"NETWORK STATUS");const i=t.pos.y-t.size.y/2+40,s=18,r=e>5?"UNSTABLE":"STABLE",o=e>5?this.colors.warning:this.colors.terminal;this.drawGlowText("CONNECTION:",vec2(t.pos.x,i),this.colors.terminal,10),this.drawGlowText(r,vec2(t.pos.x,i+s),o,12),this.drawGlowText("FIREWALL:",vec2(t.pos.x,i+s*2.5),this.colors.terminal,10);const l=e%10===0&&e>0?"CHALLENGE":"ACTIVE",n=e%10===0&&e>0?this.colors.virus:this.colors.terminal;this.drawGlowText(l,vec2(t.pos.x,i+s*3.5),n,12);const f=Math.max(50,100-e*2);this.drawGlowText("INTEGRITY:",vec2(t.pos.x,i+s*5),this.colors.terminal,10);const u=f<70?this.colors.virus:this.colors.terminal;this.drawGlowText(`${f}%`,vec2(t.pos.x,i+s*6),u,12);const S=parseInt(localStorage.getItem("voidBlocksHighScore")||"0");S>0&&(this.drawGlowText("HIGH SCORE:",vec2(t.pos.x,i+s*7.5),this.colors.data,10),this.drawGlowText(this.formatNumber(S),vec2(t.pos.x,i+s*8.5),this.colors.data,12))}renderInstructions(){const e={pos:vec2(400,520),size:vec2(360,80)};this.renderPanel(e,null);const t=["ARROW KEYS / WASD - MOVE","SPACE / UP - ROTATE","ESC - PAUSE SYSTEM"],i=e.pos.y-e.size.y/2+15;t.forEach((s,r)=>{this.drawGlowText(s,vec2(e.pos.x,i+r*18),this.colors.terminal,10)})}renderTitle(){const e=vec2(400,30);this.drawGlowText("VOID BLOCKS",e,this.colors.data,24,!0);const t=vec2(400,50);this.drawGlowText("NEURAL NETWORK SECURITY PROTOCOL",t,this.colors.terminal,10);const i=vec2(780,580);this.drawGlowText("v1.0.0",i,new Color(.3,.3,.3,1),8)}drawGlowText(e,t,i,s=16,r=!1){let o=t;(i===this.colors.virus||i===this.colors.warning)&&(this.glitchOffset=vec2(Math.sin(time*20)*2,Math.cos(time*15)*1),o=t.add(this.glitchOffset));const l=3;for(let n=l;n>=0;n--){const f=new Color(i.r,i.g,i.b,i.a*(n/l)*.3),u=vec2(n,n);drawText(e,o.add(u),s,f)}drawText(e,o,s,i)}formatNumber(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}renderGameOver(e,t,i,s){const r=new Color(0,0,0,.8);drawRect(vec2(400,300),vec2(800,600),r);const o=vec2(400,200);this.drawGlowText("SYSTEM COMPROMISED",o,this.colors.virus,28,!0);const l=vec2(400,280);this.drawGlowText("FINAL STATISTICS",l,this.colors.data,18);const n=320;this.drawGlowText(`SCORE: ${this.formatNumber(e)}`,vec2(400,n),this.colors.terminal,16),this.drawGlowText(`LEVEL: ${t}`,vec2(400,n+25),this.colors.terminal,16),this.drawGlowText(`LINES: ${i}`,vec2(400,n+50),this.colors.terminal,16),s&&this.drawGlowText("NEW HIGH SCORE!",vec2(400,n+85),this.colors.warning,18,!0),this.drawGlowText("PRESS R TO RESTART",vec2(400,480),this.colors.data,16)}};window.UI=O;function I(){return new Promise(a=>{if(typeof engineInit<"u")a();else{const e=setInterval(()=>{typeof engineInit<"u"&&(clearInterval(e),a())},50)}})}const M=800,G=600,y=10,E=20,L=24;let c,h,d,C,p="playing";function R(){setCameraScale(1),c=new Grid(y,E,L),d=new GameLogic,C=new UI,g(),setCanvasSize(vec2(M,G))}function A(){p==="playing"&&(F(),d.update(),d.shouldDropPiece()&&(w(0,1)||(T(),g())),c.update())}function D(){}function N(){c.render(),h&&h.render()}function b(){C.render(d.getScore(),d.getLevel(),d.getLines())}function F(){(keyWasPressed("ArrowLeft")||keyWasPressed("KeyA"))&&w(-1,0),(keyWasPressed("ArrowRight")||keyWasPressed("KeyD"))&&w(1,0),(keyWasPressed("ArrowDown")||keyWasPressed("KeyS"))&&(w(0,1)||(T(),g())),(keyWasPressed("ArrowUp")||keyWasPressed("KeyW")||keyWasPressed("Space"))&&H()}function w(a,e){if(!h)return!1;const t=h.x+a,i=h.y+e;return c.canPlacePiece(h,t,i)?(h.x=t,h.y=i,!0):!1}function H(){if(!h)return;const a=h.getRotated();c.canPlacePiece(a,h.x,h.y)&&h.rotate()}function T(){if(!h)return;c.placePiece(h);const a=c.clearFullLines();a>0&&d.addScore(a),c.isGameOver()&&(p="gameOver",d.gameOver())}function g(){h=new Piece(Math.floor(y/2),0),c.canPlacePiece(h,h.x,h.y)||(p="gameOver",d.gameOver())}I().then(()=>{engineInit(R,A,D,N,b)});
